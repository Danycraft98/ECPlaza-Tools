{% extends 'base.html' %}


{% block style %}
    <link rel='stylesheet' href='//cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css'>
{% endblock %}


{% block content %}
    <section id="auth-button"></section>

    <div class='col-md-12 graph_wrap'>
        <span>Users Sessions</span>

        # select box to change type of graph
        <span class='col-md-4 select_box'>
            <select id='chart-type-1' aria-label=''>
                <option value='LINE'>Line</option>
                <option value='COLUMN'>Column</option>
                <option value='TABLE'>Table</option>
            </select>
        </span>

        # select box to switch between 1 week and 1 month
        <span class='col-md-4 select_box'>
            <select id='chart-1' aria-label=''>
                <option value='30daysAgo'>Last 30 Days</option>
                <option value='7daysAgo'>Last 7 Days</option>
            </select>
        </span>

        <div class='clearfix'></div>
        <div id='chart-1-container'></div>
    </div>
{% endblock %}


{% block script %}
    <script src='//cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js'></script>
    <script>
        gapi.analytics.ready(function () {
            /*gapi.auth.authorize({client_id: '117503275351610672621', scope: ['https://www.googleapis.com/auth/analytics.readonly']}, function (resp) {
                console.log(resp)
            });*/
            gapi.analytics.auth.authorize({
                'serverAuth': {
                    'access_token': '{{ google_access_token }}'
                }
            });

            gapi.analytics.auth.on('signIn', function () {
                //console.log(gapi.analytics.auth.getUserProfile());
            });
            const dataChart1 = new gapi.analytics.googleCharts.DataChart({
                query: {
                    'ids': '{{ google_userid }}',
                    'start-date': '30daysAgo',
                    'end-date': 'today',
                    'metrics': 'ga:sessions',
                    'dimensions': 'ga:date',
                    'sort': '-ga:date'
                },
                chart: {
                    'container': 'chart-1-container',
                    'type': 'LINE',
                    'options': {
                        'width': '100%'
                    }
                }
            });
            dataChart1.execute();

            //To change when selectbox value is changed
            $('#chart-1').change(function () {
                dataChart1.set({query: {'start-date': $('#chart-1').val()}, chart: {'type': $('#chart-type-1').val()}})
                dataChart1.execute();
            })
            $('#chart-type-1').change(function () {
                dataChart1.set({query: {'start-date': $('#chart-1').val()}, chart: {'type': $('#chart-type-1').val()}})
                dataChart1.execute();
            })
        })
        ;
    </script>

{% endblock %}
